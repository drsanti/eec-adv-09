"use strict";Object.defineProperty(exports,"__esModule",{value:true});var UIUtils=function(){function UIUtils(){}UIUtils.generateId=function(prefix){return(prefix?prefix+"-":"'")+Math.floor(Math.random()*1e3)+"-"+Math.floor(Math.random()*1e5)};UIUtils.opts=function(arg,def){if(arg===null||arg===undefined){return def}return arg};return UIUtils}();var UIWrapper=function(){function UIWrapper(options){this.parentId=options.parentId||null;this.useInline=options.useInline||false;this.className=options.className||"";this.wrapperId=options.wrapperId||UIUtils.generateId("wrapper");this.innerHtml=options.innerHtml||"";this.element=document.createElement("div");this.element.id=this.wrapperId;this.element.innerHTML=this.innerHtml;if(this.parentId===null||this.parentId===undefined){document.body.appendChild(this.element)}else if(typeof this.parentId==="string"&&this.parentId!==""){var p=document.getElementById(this.parentId);if(p!==null){p.appendChild(this.element)}else{console.error("Cannot get the parent element "+this.parentId)}}if(this.useInline){this.element.style.display="inline-block";this.element.style.marginLeft="5px";this.element.style.marginRight="5px"}this.addClass("ui-wrapper")}UIWrapper.prototype.getElement=function(){return this.element};UIWrapper.prototype.getId=function(){return this.getElement().id};UIWrapper.prototype.appendChild=function(child){this.element.appendChild(child);return this};UIWrapper.prototype.removeChild=function(child){this.element.removeChild(child);return this};UIWrapper.prototype.setStyle=function(key,val,priority){this.element.style.setProperty(key,val,priority?priority:"");return this};UIWrapper.prototype.addClass=function(className){this.element.classList.add(className);return this};UIWrapper.prototype.removeClass=function(className){this.element.classList.remove(className);return this};UIWrapper.prototype.setHtml=function(html){this.element.innerHTML=html;return this};UIWrapper.prototype.appendHtml=function(html){this.element.innerHTML+=html;return this};return UIWrapper}();var UIButton=function(){function UIButton(options){options=options||{};this.buttonId=options.buttonId||UIUtils.generateId("btn");this.text=options.text||"Button";this.className=options.className||"btn-primary";this.className=this.className.replace("btn-","");this.iconLeft=options.iconLeft||"";this.iconRight=options.iconRight||"";this.iconLeft=this.iconLeft.replace("fa-","");this.iconRight=this.iconRight.replace("fa-","");var iconLeftHtml=this.iconLeft?'<span class="fa fa-'+this.iconLeft+'"  id="icon-left-'+this.buttonId+'"></span>':"";var iconRightHtml=this.iconRight?'<span class="fa fa-'+this.iconRight+'" id="icon-right-'+this.buttonId+'"></span>':"";var html='\n            <button type="button" class="btn btn-'+this.className+' ui-button" id="'+this.buttonId+'">\n                '+iconLeftHtml+" "+this.text+" "+iconRightHtml+"\n            </button>";this.parentId=options.parentId||null;this.callback=options.callback||null;this.wrapper=new UIWrapper({innerHtml:html,wrapperId:"wrapper-"+this.buttonId,parentId:this.parentId});this.wrapper.addClass("ui-button");if(options.useInline===true){this.wrapper.setStyle("display","inline-block")}if(this.callback){document.getElementById(this.buttonId).addEventListener("click",this.callback)}}UIButton.prototype.getButton=function(){return document.getElementById(this.buttonId)};UIButton.prototype.getButtonId=function(){return this.buttonId};UIButton.prototype.getWrapper=function(){return this.wrapper.getElement()};UIButton.prototype.getWrapperId=function(){return this.wrapper.getId()};return UIButton}();var UILed=function(){function UILed(options){options=options||{};this.useInline=UIUtils.opts(options.useInline,true);this.margin=UIUtils.opts(options.margin,20);this.parentId=options.parentId||null;this.ledId=options.ledId||UIUtils.generateId("led");this.className=options.className||"led-red";this.className=this.className.replace("led-","");this.classOn=["led-red","led-yellow","led-green","led-blue"];this.classOff=["led-red-off","led-yellow-off","led-green-off","led-blue-off"];this.wrapper=new UIWrapper({wrapperId:"wrapper-"+this.ledId,parentId:this.parentId,useInline:this.useInline});this.wrapper.addClass("led");this.wrapper.addClass("ui-led");this.wrapper.getElement().style.margin="10px "+this.margin+"px 10px "+this.margin+"px";this.off()}UILed.prototype.on=function(){this.wrapper.removeClass("led-"+this.className+"-off");this.wrapper.addClass("led-"+this.className);this.state=true;return this};UILed.prototype.off=function(){this.wrapper.removeClass("led-"+this.className);this.wrapper.addClass("led-"+this.className+"-off");this.state=false;return this};UILed.prototype.toggle=function(){if(this.state===true){this.off()}else{this.on()}return this};UILed.prototype.flash=function(period){var _this=this;period=period<10?10:period;period=period>5e3?5e3:period;this.on();clearTimeout(this.timer);this.timer=setTimeout(function(){return _this.off()},period);return this};UILed.prototype.clr=function(){this.off()};UILed.prototype.set=function(){this.on()};UILed.prototype.inv=function(){this.toggle()};UILed.prototype.fls=function(period){this.flash(period);return this};return UILed}();var UIPanel=function(){function UIPanel(options){options=options||{};this.panelId=options.panelId||UIUtils.generateId("panel");this.useInline=options.useInline||false;this.text=options.text||"";this.className=options.className||"bg-dark";this.className=this.className.replace("bg-","");this.iconLeft=options.iconLeft||"";this.iconRight=options.iconRight||"";this.iconLeft=this.iconLeft.replace("fa-","");this.iconRight=this.iconRight.replace("fa-","");var iconLeftHtml=this.iconLeft?'<span class="fa fa-'+this.iconLeft+'"  id="icon-left-'+this.panelId+'"></span>':"";var iconRightHtml=this.iconRight?'<span class="fa fa-'+this.iconRight+'" id="icon-right-'+this.panelId+'"></span>':"";var html='\n        <div class="card bg-'+this.className+'" id="card-'+this.panelId+'">\n            <div class="card-header" id="header-'+this.panelId+'">\n                '+iconLeftHtml+" "+this.text+" "+iconRightHtml+'\n            </div>\n            <div class="card-body" id="body-'+this.panelId+'"></div>\n        </div>';this.parentId=options.parentId||null;this.wrapper=new UIWrapper({innerHtml:html,wrapperId:"wrapper-"+this.panelId,parentId:this.parentId})}UIPanel.prototype.getWrapperId=function(){return document.getElementById("wrapper-"+this.panelId).id};UIPanel.prototype.getCardId=function(){return document.getElementById("card-"+this.panelId).id};UIPanel.prototype.getHeaderId=function(){return document.getElementById("header-"+this.panelId).id};UIPanel.prototype.getBodyId=function(){return document.getElementById("body-"+this.panelId).id};UIPanel.prototype.getWrapperElement=function(){return document.getElementById("wrapper-"+this.panelId)};UIPanel.prototype.getCardElement=function(){return document.getElementById("card-"+this.panelId)};UIPanel.prototype.getHeaderElement=function(){return document.getElementById("header-"+this.panelId)};UIPanel.prototype.getBodyElement=function(){return document.getElementById("body-"+this.panelId)};return UIPanel}();var UIText=function(){function UIText(options){options=options||{};this.textId=options.textId||UIUtils.generateId("text");this.textAlign=options.textAlign||"left";this.useInline=options.useInline||false;this.text=options.text||"Text";this.className=options.className||"alert-warning";this.className=this.className.replace("alert-","");this.iconLeft=options.iconLeft||"";this.iconRight=options.iconRight||"";this.iconLeft=this.iconLeft.replace("fa-","");this.iconRight=this.iconRight.replace("fa-","");var iconLeftHtml=this.iconLeft?'<span class="fa fa-'+this.iconLeft+'"  id="icon-left-'+this.textId+'"></span>':"";var iconRightHtml=this.iconRight?'<span class="fa fa-'+this.iconRight+'" id="icon-right-'+this.textId+'"></span>':"";var html='\n            <div class="alert alert-'+this.className+' ui-text" id="'+this.textId+'">\n                '+iconLeftHtml+" "+this.text+" "+iconRightHtml+"\n            </div>\n        ";this.parentId=options.parentId||null;this.wrapper=new UIWrapper({innerHtml:html,wrapperId:"wrapper-"+this.textId,parentId:this.parentId,useInline:this.useInline});this.wrapper.addClass("ui-text");this.wrapper.setStyle("text-align",this.textAlign)}UIText.prototype.getIconLeftElement=function(){console.log("get: "+("icon-left-"+this.textId));return document.getElementById("icon-left-"+this.textId)};UIText.prototype.getIconRightElement=function(){return document.getElementById("icon-right-"+this.textId)};UIText.prototype.getTextElement=function(){return document.getElementById(""+this.textId)};UIText.prototype.setTextColor=function(color){this.getTextElement().style.color=color;return this};UIText.prototype.setIconLeftColor=function(color){this.getIconLeftElement().style.color=color;return this};UIText.prototype.setIconRightColor=function(color){this.getIconRightElement().style.color=color;return this};UIText.prototype.setInnerText=function(text){this.getTextElement().innerHTML=text;return this};UIText.prototype.setInnerHtml=function(text){this.getTextElement().innerHTML=text;return this};UIText.prototype.setTextAlignMode=function(alignMode){this.wrapper.getElement().style.textAlign=alignMode;return this};return UIText}();function PureKnob(){this._ticked_=false;setInterval(()=>{this._ticked_=true},100);this.createBarGraph=function(width,height){var heightString=height.toString();var widthString=width.toString();var canvas=document.createElement("canvas");var div=document.createElement("div");div.style.display="inline-block";div.style.height=heightString+"px";div.style.position="relative";div.style.textAlign="center";div.style.width=widthString+"px";div.appendChild(canvas);var graph={_canvas:canvas,_div:div,_height:height,_width:width,_properties:{colorBG:"#181818",colorFG:"#ff8800",colorMarkers:"#888888",markerStart:0,markerEnd:100,markerStep:20,trackWidth:.5,valMin:0,valMax:100,valPeaks:[],val:0},getPeaks:function(){var properties=this._properties;var peaks=properties.valPeaks;var numPeaks=peaks.length;var peaksCopy=[];for(var i=0;i<numPeaks;i++){var peak=peaks[i];peaksCopy.push(peak)}return peaksCopy},getProperty:function(key){var properties=this._properties;var value=properties[key];return value},getValue:function(){var properties=this._properties;var value=properties.val;return value},node:function(){var div=this._div;return div},redraw:function(){this.resize();var properties=this._properties;var colorTrack=properties.colorBG;var colorFilling=properties.colorFG;var colorMarkers=properties.colorMarkers;var markerStart=properties.markerStart;var markerEnd=properties.markerEnd;var markerStep=properties.markerStep;var trackWidth=properties.trackWidth;var valMin=properties.valMin;var valMax=properties.valMax;var peaks=properties.valPeaks;var value=properties.val;var height=this._height;var width=this._width;var lineWidth=Math.round(trackWidth*height);var halfWidth=.5*lineWidth;var centerY=.5*height;var lineTop=centerY-halfWidth;var lineBottom=centerY+halfWidth;var relativeValue=(value-valMin)/(valMax-valMin);var fillingEnd=width*relativeValue;var numPeaks=peaks.length;var canvas=this._canvas;var ctx=canvas.getContext("2d");ctx.clearRect(0,0,width,height);if(markerStart!==null&markerEnd!==null&markerStep!==null&markerStep!==0){for(var v=markerStart;v<=markerEnd;v+=markerStep){var relativePos=(v-valMin)/(valMax-valMin);var pos=Math.round(width*relativePos);ctx.beginPath();ctx.moveTo(pos,0);ctx.lineTo(pos,height);ctx.lineCap="butt";ctx.lineWidth="2";ctx.strokeStyle=colorMarkers;ctx.stroke()}}ctx.beginPath();ctx.rect(0,lineTop,width,lineWidth);ctx.fillStyle=colorTrack;ctx.fill();ctx.beginPath();ctx.rect(0,lineTop,fillingEnd,lineWidth);ctx.fillStyle=colorFilling;ctx.fill();for(var i=0;i<numPeaks;i++){var peak=peaks[i];var relativePeak=(peak-valMin)/(valMax-valMin);var pos=Math.round(width*relativePeak);ctx.beginPath();ctx.moveTo(pos,lineTop);ctx.lineTo(pos,lineBottom);ctx.lineCap="butt";ctx.lineWidth="2";ctx.strokeStyle=colorFilling;ctx.stroke()}},resize:function(){var canvas=this._canvas;canvas.style.height="100%";canvas.style.width="100%";canvas.height=this._height;canvas.width=this._width},setPeaks:function(peaks){var properties=this._properties;var peaksCopy=[];var numPeaks=peaks.length;for(var i=0;i<numPeaks;i++){var peak=peaks[i];peaksCopy.push(peak)}this.setProperty("valPeaks",peaksCopy)},setProperty:function(key,value){this._properties[key]=value;this.redraw()},setValue:function(value){var properties=this._properties;var valMin=properties.valMin;var valMax=properties.valMax;if(value<valMin)value=valMin;else if(value>valMax)value=valMax;value=Math.round(value);this.setProperty("val",value)}};var resizeListener=function(e){graph.redraw()};canvas.addEventListener("resize",resizeListener);return graph};this.createKnob=function(width,height,type){var heightString=height.toString();var widthString=width.toString();var smaller=width<height?width:height;var fontSize=.2*smaller;var fontSizeString=fontSize.toString();var canvas=document.createElement("canvas");var div=document.createElement("div");div.style.display="inline-block";div.style.height=heightString+"px";div.style.position="relative";div.style.textAlign="center";div.style.width=widthString+"px";div.appendChild(canvas);var input=document.createElement("input");input.style.appearance="textfield";input.style.backgroundColor="rgba(0, 0, 0, 0.8)";input.style.border="none";input.style.color="#ff8800";input.style.fontFamily="sans-serif";input.style.fontSize=fontSizeString+"px";input.style.height=heightString+"px";input.style.margin="auto";input.style.padding="0px";input.style.textAlign="center";input.style.width=widthString+"px";var inputMode=document.createAttribute("inputmode");inputMode.value="numeric";input.setAttributeNode(inputMode);var inputDiv=document.createElement("div");inputDiv.style.bottom="0px";inputDiv.style.display="none";inputDiv.style.left="0px";inputDiv.style.position="absolute";inputDiv.style.right="0px";inputDiv.style.top="0px";inputDiv.appendChild(input);div.appendChild(inputDiv);const self=this;var knob={_canvas:canvas,_div:div,_height:height,_input:input,_inputDiv:inputDiv,_listeners:[],_mousebutton:false,_previousVal:0,_timeout:null,_timeoutDoubleTap:null,_touchCount:0,_width:width,_notifyUpdate:function(){var properties=this._properties;var value=properties.val;var listeners=this._listeners;var numListeners=listeners.length;for(var i=0;i<numListeners;i++){var listener=listeners[i];if(listener!==null)listener(this,value)}},_properties:{angleEnd:2*Math.PI,angleOffset:-.5*Math.PI,angleStart:0,colorBG:"#181818",colorFG:"#ff8800",colorLabel:"#ffffff",fnStringToValue:function(string){return parseInt(string)},fnValueToString:function(value){return value.toString()},label:null,needle:false,readonly:false,textScale:1,trackWidth:.4,valMin:0,valMax:100,val:0},abort:function(){var previousValue=this._previousVal;var properties=this._properties;properties.val=previousValue;this.redraw()},addListener:function(listener){var listeners=this._listeners;listeners.push(listener)},commit:function(){var properties=this._properties;var value=properties.val;this._previousVal=value;this.redraw();this._notifyUpdate()},getProperty:function(key){var properties=this._properties;var value=properties[key];return value},getValue:function(){var properties=this._properties;var value=properties.val;return value},node:function(){var div=this._div;return div},redraw:function(){this.resize();var properties=this._properties;var needle=properties.needle;var angleStart=properties.angleStart;var angleOffset=properties.angleOffset;var angleEnd=properties.angleEnd;var actualStart=angleStart+angleOffset;var actualEnd=angleEnd+angleOffset;var label=properties.label;var value=properties.val;var valueToString=properties.fnValueToString;var valueStr=valueToString(value);var valMin=properties.valMin;var valMax=properties.valMax;var relValue=(value-valMin)/(valMax-valMin);var relAngle=relValue*(angleEnd-angleStart);var angleVal=actualStart+relAngle;var colorTrack=properties.colorBG;var colorFilling=properties.colorFG;var colorLabel=properties.colorLabel;var textScale=properties.textScale;var trackWidth=properties.trackWidth;var height=this._height;var width=this._width;var smaller=width<height?width:height;var centerX=.5*width;var centerY=.5*height;var radius=.4*smaller;var labelY=centerY+radius;var lineWidth=Math.round(trackWidth*radius);var labelSize=Math.round(.8*lineWidth);var labelSizeString=labelSize.toString();var fontSize=.2*smaller*textScale;var fontSizeString=fontSize.toString();var canvas=this._canvas;var ctx=canvas.getContext("2d");ctx.clearRect(0,0,width,height);ctx.beginPath();ctx.arc(centerX,centerY,radius,actualStart,actualEnd);ctx.lineCap="butt";ctx.lineWidth=lineWidth;ctx.strokeStyle=colorTrack;ctx.stroke();ctx.beginPath();if(needle)ctx.arc(centerX,centerY,radius,angleVal-.1,angleVal+.1);else ctx.arc(centerX,centerY,radius,actualStart,angleVal);ctx.lineCap="butt";ctx.lineWidth=lineWidth;ctx.strokeStyle=colorFilling;ctx.stroke();ctx.font=fontSizeString+"px sans-serif";ctx.fillStyle=colorFilling;ctx.textAlign="center";ctx.textBaseline="middle";ctx.fillText(valueStr,centerX,centerY);if(label!==null){ctx.font=labelSizeString+"px sans-serif";ctx.fillStyle=colorLabel;ctx.textAlign="center";ctx.textBaseline="middle";ctx.fillText(label,centerX,labelY)}var elemInput=this._input;elemInput.style.color=colorFilling;elemInput.style.fontSize=fontSizeString+"px"},resize:function(){var canvas=this._canvas;canvas.style.height="100%";canvas.style.width="100%";canvas.height=this._height;canvas.width=this._width},setProperty:function(key,value){this._properties[key]=value;this.redraw()},setValue:function(value){this.setValueFloating(value);this.commit()},setValueFloating:function(value){var properties=this._properties;var valMin=properties.valMin;var valMax=properties.valMax;if(value<valMin)value=valMin;else if(value>valMax)value=valMax;value=Math.round(value);this.setProperty("val",value)}};var mouseEventToValue=function(e,properties){var canvas=e.target;var width=canvas.scrollWidth;var height=canvas.scrollHeight;var centerX=.5*width;var centerY=.5*height;var x=e.offsetX;var y=e.offsetY;var relX=x-centerX;var relY=y-centerY;var angleStart=properties.angleStart;var angleEnd=properties.angleEnd;var angleDiff=angleEnd-angleStart;var angle=Math.atan2(relX,-relY)-angleStart;var twoPi=2*Math.PI;if(angle<0){if(angleDiff>=twoPi)angle+=twoPi;else angle=0}var valMin=properties.valMin;var valMax=properties.valMax;var value=angle/angleDiff*(valMax-valMin)+valMin;if(value<valMin)value=valMin;else if(value>valMax)value=valMax;return value};var touchEventToValue=function(e,properties){var canvas=e.target;var rect=canvas.getBoundingClientRect();var offsetX=rect.left;var offsetY=rect.top;var width=canvas.scrollWidth;var height=canvas.scrollHeight;var centerX=.5*width;var centerY=.5*height;var touches=e.targetTouches;var touch=null;if(touches.length>0)touch=touches.item(0);var x=0;var y=0;if(touch!==null){var touchX=touch.pageX;x=touchX-offsetX;var touchY=touch.pageY;y=touchY-offsetY}var relX=x-centerX;var relY=y-centerY;var angleStart=properties.angleStart;var angleEnd=properties.angleEnd;var angleDiff=angleEnd-angleStart;var angle=Math.atan2(relX,-relY)-angleStart;var twoPi=2*Math.PI;if(angle<0){if(angleDiff>=twoPi)angle+=twoPi;else angle=0}var valMin=properties.valMin;var valMax=properties.valMax;var value=angle/angleDiff*(valMax-valMin)+valMin;if(value<valMin)value=valMin;else if(value>valMax)value=valMax;return value};var doubleClickListener=function(e){var properties=knob._properties;var readonly=properties.readonly;if(!readonly){e.preventDefault();var inputDiv=knob._inputDiv;inputDiv.style.display="block";var inputElem=knob._input;inputElem.focus();knob.redraw()}};var mouseDownListener=function(e){var btn=e.buttons;if(btn===1){var properties=knob._properties;var readonly=properties.readonly;if(!readonly){e.preventDefault();var val=mouseEventToValue(e,properties);knob.setValueFloating(val)}knob._mousebutton=true}if(btn===4){var properties=knob._properties;var readonly=properties.readonly;if(!readonly){e.preventDefault();var inputDiv=knob._inputDiv;inputDiv.style.display="block";var inputElem=knob._input;inputElem.focus();knob.redraw()}}};var mouseMoveListener=function(e){var btn=knob._mousebutton;if(btn){var properties=knob._properties;var readonly=properties.readonly;if(!readonly){e.preventDefault();var val=mouseEventToValue(e,properties);knob.setValueFloating(val);if(self._ticked_){knob.setValue(val);self._ticked_=false}}}};var mouseUpListener=function(e){var btn=knob._mousebutton;if(btn){var properties=knob._properties;var readonly=properties.readonly;if(!readonly){e.preventDefault();var val=mouseEventToValue(e,properties);knob.setValue(val)}}knob._mousebutton=false};var mouseCancelListener=function(e){var btn=knob._mousebutton;if(btn){knob.abort();knob._mousebutton=false}};var touchStartListener=function(e){var properties=knob._properties;var readonly=properties.readonly;if(!readonly){var touches=e.targetTouches;var numTouches=touches.length;var singleTouch=numTouches===1;if(singleTouch){knob._mousebutton=true;if(knob._touchCount===0){var f=function(){if(knob._touchCount===2){var properties=knob._properties;var readonly=properties.readonly;if(!readonly){e.preventDefault();var inputDiv=knob._inputDiv;inputDiv.style.display="block";var inputElem=knob._input;inputElem.focus();knob.redraw()}}knob._touchCount=0};var timeout=knob._timeoutDoubleTap;window.clearTimeout(timeout);timeout=window.setTimeout(f,500);knob._timeoutDoubleTap=timeout}knob._touchCount++;var val=touchEventToValue(e,properties);knob.setValueFloating(val)}}};var touchMoveListener=function(e){var btn=knob._mousebutton;if(btn){var properties=knob._properties;var readonly=properties.readonly;if(!readonly){var touches=e.targetTouches;var numTouches=touches.length;var singleTouch=numTouches===1;if(singleTouch){e.preventDefault();var val=touchEventToValue(e,properties);knob.setValueFloating(val)}}}};var touchEndListener=function(e){var btn=knob._mousebutton;if(btn){var properties=knob._properties;var readonly=properties.readonly;if(!readonly){var touches=e.targetTouches;var numTouches=touches.length;var noMoreTouches=numTouches===0;if(noMoreTouches){e.preventDefault();knob._mousebutton=false;knob.commit()}}}knob._mousebutton=false};var touchCancelListener=function(e){var btn=knob._mousebutton;if(btn){knob.abort();knob._touchCount=0;var timeout=knob._timeoutDoubleTap;window.clearTimeout(timeout)}knob._mousebutton=false};var resizeListener=function(e){knob.redraw()};var scrollListener=function(e){var readonly=knob.getProperty("readonly");if(!readonly){e.preventDefault();var delta=e.deltaY;var direction=delta>0?1:delta<0?-1:0;var val=knob.getValue();val+=direction;knob.setValueFloating(val);var commit=function(){knob.commit()};var timeout=knob._timeout;window.clearTimeout(timeout);timeout=window.setTimeout(commit,250);knob._timeout=timeout}};var keyPressListener=function(e){var kc=e.keyCode;if(kc===13||kc===27){var inputDiv=knob._inputDiv;inputDiv.style.display="none";var input=e.target;if(kc===13){var properties=knob._properties;var value=input.value;var stringToValue=properties.fnStringToValue;var val=stringToValue(value);var valid=isFinite(val);if(valid)knob.setValue(val)}input.value=""}};if(type=="gauge")return knob;canvas.addEventListener("dblclick",doubleClickListener);canvas.addEventListener("mousedown",mouseDownListener);canvas.addEventListener("mouseleave",mouseCancelListener);canvas.addEventListener("mousemove",mouseMoveListener);canvas.addEventListener("mouseup",mouseUpListener);canvas.addEventListener("resize",resizeListener);canvas.addEventListener("touchstart",touchStartListener);canvas.addEventListener("touchmove",touchMoveListener);canvas.addEventListener("touchend",touchEndListener);canvas.addEventListener("touchcancel",touchCancelListener);canvas.addEventListener("wheel",scrollListener);input.addEventListener("keypress",keyPressListener);return knob}}var UIGauge=function(){function UIGauge(options){options=options||{};this.size=options.size||100;this.gaugeId=options.gaugeId||UIUtils.generateId("gauge");this.max=options.max||100;this.min=options.min||0;this.val=options.val||this.min+(this.max-this.min)/2;this.parentId=options.parentId;this.hue=options.hue||10;this.saturation=options.saturation||100;this.ligthness=options.ligthness||50;this.useInline=UIUtils.opts(options.useInline,false);this.useAdaptiveColor=UIUtils.opts(options.useAdaptiveColor,false);var PureKnob$1=new PureKnob;this.knob=PureKnob$1.createKnob(this.size,this.size,"gauge");this.knob.setProperty("angleStart",-0*Math.PI);this.knob.setProperty("angleEnd",2*Math.PI);this.knob.setProperty("trackWidth",.3);this.knob.setProperty("valMin",this.min);this.knob.setProperty("valMax",this.max);this.setValue(this.val);this.wrapper=new UIWrapper({parentId:this.parentId,wrapperId:"wrapper-"+this.gaugeId,useInline:this.useInline});this.wrapper.addClass("ui-gauge");this.wrapper.getElement().appendChild(this.knob.node())}UIGauge.prototype.setValue=function(val){this.val=val<this.min?this.min:val;this.val=val>this.max?this.max:val;this.knob.setValue(this.val);if(this.useAdaptiveColor===true){this.knob.setProperty("colorFG","hsl("+this.hue+", "+100*this.val/this.max+"%, "+this.ligthness+"%)")}else{this.knob.setProperty("colorFG","hsl("+this.hue+", "+this.saturation+"%, "+this.ligthness+"%)")}return this};UIGauge.prototype.setHSL=function(h,s,l){this.hue=h;this.saturation=s;this.ligthness=l;this.setValue(this.val);return this};return UIGauge}();var UIKnob=function(){function UIKnob(options){var _this=this;options=options||{};this.callback=options.callback||null;this.size=options.size||100;this.knobId=options.knobId||UIUtils.generateId("knob");this.max=options.max||100;this.min=options.min||0;this.val=options.val||this.min+(this.max-this.min)/2;this.parentId=options.parentId;this.hue=options.hue||10;this.saturation=options.saturation||100;this.ligthness=options.ligthness||50;this.useInline=UIUtils.opts(options.useInline,true);this.useAdaptiveColor=UIUtils.opts(options.useAdaptiveColor,true);var PureKnob$1=new PureKnob;this.knob=PureKnob$1.createKnob(this.size,this.size,"knob");this.knob.setProperty("angleStart",-.75*Math.PI);this.knob.setProperty("angleEnd",.75*Math.PI);this.knob.setProperty("trackWidth",.4);this.knob.setProperty("valMin",this.min);this.knob.setProperty("valMax",this.max);this.knob.setValue(this.val);this.knob.setProperty("colorFG","hsl("+this.hue+", "+100*this.val/this.max+"%, "+this.ligthness+"%)");this.wrapper=new UIWrapper({parentId:this.parentId,wrapperId:"wrapper-"+this.knobId,useInline:this.useInline}).setStyle("cursor","pointer");this.wrapper.addClass("ui-knob");this.wrapper.getElement().appendChild(this.knob.node());this.knob.addListener(function(knob,value){if(_this.callback){_this.val=value;_this.callback(_this.val,_this.knobId)}if(_this.useAdaptiveColor===true){_this.knob.setProperty("colorFG","hsl("+_this.hue+", "+100*_this.val/_this.max+"%, "+_this.ligthness+"%)")}else{_this.knob.setProperty("colorFG","hsl("+_this.hue+", "+_this.saturation+"%, "+_this.ligthness+"%)")}})}return UIKnob}();var UILayout=function(){function UILayout(options){options=options||{};this.parentId=options.parentId||null;this.className=options.className||"";this.layoutId=options.layoutId||UIUtils.generateId("layout");this.rows=options.rows||1;this.cols=options.cols||1;var html='<div class="container ui-layout '+this.className+'">';for(var r=0;r<this.rows;r++){html+='<div class="row" id="r'+r+'">';for(var c=0;c<this.cols;c++){html+='<div class="col-sm" id="r'+r+"c"+c+"-"+this.layoutId+'"></div>'}html+="</div>"}html+="</div>";this.wrapper=new UIWrapper({innerHtml:html,wrapperId:"layout-"+this.layoutId,parentId:this.parentId})}UILayout.prototype.getRowColId=function(row,col){return"r"+row+"c"+col+"-"+this.layoutId};UILayout.prototype.addElement=function(row,col,ele){document.getElementById(this.getRowColId(row,col)).appendChild(ele);return this};return UILayout}();function AIot(){this.port=3998;this.socket=null;this.adc_vals=[0,0,0,0];this.adc_delta=5;this.adcReq_cbks=[null,null,null,null];this.ledReq_cbks=[null,null,null,null];this.pswReq_cbks=[null,null,null,null];this.adcSub_cbks=[null,null,null,null];this.pswSub_cbks=[null,null,null,null];this.timer=null}AIot.prototype.__process_server_message=function(json){json=JSON.parse(json);if(json.tag=="psw"&&json.type=="req"){let id=Number(json.id);if(this.pswReq_cbks[id]){this.pswReq_cbks[id](json)}}if(json.tag=="psw"&&json.type=="sub"){let id=Number(json.id);if(this.pswSub_cbks[id]){this.pswSub_cbks[id](json)}}else if(json.tag=="adc"){let id=Number(json.id);json.val=json.val*100/1023;if(this.adcReq_cbks[id]){this.adcReq_cbks[id](json)}let i=id;if(this.adcSub_cbks[i]){if(this.adc_vals[i]>Number(json.val+this.adc_delta)){json.dir="dec"}else if(Number(json.val)>this.adc_vals[i]+this.adc_delta){json.dir="inc"}else{json.dir="none"}this.adcSub_cbks[i](json);this.adc_vals[i]=Number(json.val)}}else if(json.tag=="led"&&json.val=="0"||json.val=="1"){let id=Number(json.id);if(this.ledReq_cbks[id]){this.ledReq_cbks[id](json)}}};AIot.prototype.set_adc_delta=function(delta){this.adc_delta=delta};AIot.prototype.start=function(callback){return new Promise((resolve,reject)=>{this.socket=new WebSocket("ws://localhost:"+this.port+"/");this.socket.onopen=(()=>{resolve(this);if(callback){callback(this)}this.start_sampler(500)});this.socket.onmessage=(message=>{let data=message.data;this.__process_server_message(data)})})};AIot.prototype.start_sampler=function(interval){interval=interval||interval;interval=interval<100?100:interval;if(this.timer!=null)return this;this.timer=setInterval(()=>{for(let i=0;i<this.adcSub_cbks.length;i++){if(this.adcSub_cbks[i]){this.adc_req(i)}}},interval);return this};AIot.prototype.stop_sampler=function(){clearInterval(this.timer);this.timer=null};AIot.prototype.adc_req=function(id,callback){if(id>=0&&id<=3){this.socket.send(`adc:${id}:?`);this.adcReq_cbks[id]=callback}return this};AIot.prototype.led_req=function(id,callback){if(id>=0&&id<=3){this.socket.send(`led:${id}:?`);this.ledReq_cbks[id]=callback}return this};AIot.prototype.psw_req=function(id,callback){if(id>=0&&id<=3){this.socket.send(`psw:${id}:?`);this.pswReq_cbks[id]=callback;if(this.pswSub_cbks[id]){console.warn(`The psw_subscribe(${id}) is cancelled. It is overwritten by psw_get(${id}).`);this.pswSub_cbks[id]=null}}return this};AIot.prototype.adc_get=function(id,callback){this.adc_req(id,callback);return this};AIot.prototype.led_get=function(id,callback){this.led_req(id,callback);return this};AIot.prototype.psw_get=function(id,callback){this.psw_req(id,callback);return this};AIot.prototype.adc_subscribe=function(id,callback){if(id>=0&&id<=3){this.adcSub_cbks[id]=callback}return this};AIot.prototype.adc_sub=function(id,callback){return this.adc_subscribe(id,callback)};AIot.prototype.adc_unsubscribe=function(id){if(id>=0&&id<=3){this.adcSub_cbks[id]=null}return this};AIot.prototype.adc_unsub=function(id){return this.adc_unsubscribe(id)};AIot.prototype.psw_subscribe=function(id,callback){if(id>=0&&id<=3){this.socket.send(`psw:${id}:subscribe`);this.pswSub_cbks[id]=callback}return this};AIot.prototype.psw_sub=function(id,callback){return this.psw_subscribe(id,callback)};AIot.prototype.psw_unsubscribe=function(id){if(id>=0&&id<=3){this.socket.send(`psw:${id}:unsubscribe`);this.pswSub_cbks[id]=null}return this};AIot.prototype.psw_unsub=function(id){return this.psw_unsubscribe(id)};AIot.prototype.beep=function(freq,period){this.socket.send(`beep:${freq?freq:3500}:${period?period:50}`);return this};AIot.prototype.led_on=function(id){this.socket.send(`led:${id}:on`);return this};AIot.prototype.led_set=function(id){return this.led_on(id)};AIot.prototype.led_off=function(id){this.socket.send(`led:${id}:off`);return this};AIot.prototype.led_clr=function(id){return this.led_off(id)};AIot.prototype.led_toggle=function(id){this.socket.send(`led:${id}:inv`);return this};AIot.prototype.led_inv=function(id){return this.led_toggle(id)};AIot.prototype.led_flash=function(id,period){period=period?period:10;period=period<10?10:period;this.led_on(id);let tmr=setInterval(()=>{this.led_off(id);clearInterval(tmr)},period?period:10);return this};AIot.prototype.led_fls=function(id,period){return this.led_flash(id,period)};AIot.prototype.led_write=function(data){if(data instanceof Array){if(data.length>4){console.warn(`AIoT: The array length (${data.length}) too long. Only last four elements [${data.slice(data.length-4)}] are processed`);data=data.slice(data.length-4)}for(let i=0;i<data.length;i++){let k=data.length-1-i;let d=data[i];if(d==1||d==true||d=="on"||d=="set"){this.led_set(k)}else if(d==0||d==false||d=="off"||d=="clr"){this.led_clr(k)}else if(d==2||d=="inv"||d=="toggle"){this.led_inv(k)}else{console.warn(`AIoT: The command "${d}" is not allowed`)}}}else if(typeof data=="string"){if(data.length>4){console.warn(`AIoT: The string length (${data.length}) too long . Only last four characters "${data.slice(data.length-4)}" are processed`);data=data.slice(data.length-4)}for(let i=0;i<data.length;i++){let k=data.length-1-i;let d=data[i];if(d=="1"){this.led_set(k)}else if(d=="0"){this.led_clr(k)}else if(d=="2"){this.led_inv(k)}}}else{for(let i=0;i<4;i++){if(data&1){this.led_set(i)}else{this.led_clr(i)}data>>=1}}return this};AIot.prototype.repeat=function(count,period,eachCbk,endCbk){let idx=0;period=period||500;period=period<100?100:period;let t=setInterval(()=>{eachCbk(idx,t);if(++idx>=count){clearInterval(t);if(endCbk)endCbk(null)}},period);return this};AIot.prototype.sequence=function(array,period,eachCbk,endCbk){let n=0;period=period||500;period=period<100?100:period;let t=setInterval(()=>{eachCbk(array[n],n,t);if(++n>=array.length){clearInterval(t);if(endCbk)endCbk(null,null)}},period);return this};AIot.prototype.endTicker=function(t){clearInterval(t)};var LED={ID0:0,ID1:1,ID2:2,ID3:3};var PSW={ID0:0,ID1:1,ID2:2,ID3:3};var ADC={ID0:0,ID1:1,ID2:2,ID3:3};var Led=function(){function Led(aiot){this.aiot=aiot}Led.prototype.on=function(id){this.aiot.led_on(id);return this};Led.prototype.set=function(id){this.aiot.led_on(id);return this};Led.prototype.off=function(id){this.aiot.led_off(id);return this};Led.prototype.clr=function(id){this.aiot.led_off(id);return this};Led.prototype.toggle=function(id){this.aiot.led_toggle(id);return this};Led.prototype.inv=function(id){this.aiot.led_toggle(id);return this};Led.prototype.ctrl=function(id,logic){if(logic===true){this.aiot.led_on(id)}else{this.aiot.led_off(id)}};Led.prototype.req=function(id,callback){this.aiot.led_req(id,callback);return this};Led.prototype.get=function(id,callback){this.aiot.led_get(id,callback);return this};Led.prototype.flash=function(id,period){this.aiot.led_flash(id,period);return this};Led.prototype.fls=function(id,period){this.aiot.led_flash(id,period);return this};Led.prototype.write=function(data){this.aiot.led_write(data);return this};Led.prototype.wrt=function(data){this.aiot.led_write(data);return this};return Led}();var Psw=function(){function Psw(aiot){this.aiot=aiot}Psw.prototype.req=function(id,callback){this.aiot.psw_req(id,callback);return this};Psw.prototype.get=function(id,callback){this.aiot.psw_get(id,callback);return this};Psw.prototype.subscribe=function(id,callback){this.aiot.psw_subscribe(id,callback);return this};Psw.prototype.sub=function(id,callback){this.aiot.psw_subscribe(id,callback);return this};Psw.prototype.unsubscribe=function(id){this.aiot.psw_unsubscribe(id);return this};Psw.prototype.unsub=function(id){this.aiot.psw_unsubscribe(id);return this};return Psw}();var Adc=function(){function Adc(aiot){this.aiot=aiot}Adc.prototype.req=function(id,callback){this.aiot.adc_req(id,callback);return this};Adc.prototype.get=function(id,callback){this.aiot.adc_get(id,callback);return this};Adc.prototype.subscribe=function(id,callback){this.aiot.adc_subscribe(id,callback);return this};Adc.prototype.sub=function(id,callback){this.aiot.adc_subscribe(id,callback);return this};Adc.prototype.unsubscribe=function(id){this.aiot.adc_unsubscribe(id);return this};Adc.prototype.unsub=function(id){this.aiot.adc_unsubscribe(id);return this};Adc.prototype.delta=function(delta){this.aiot.set_adc_delta(delta);return this};return Adc}();var Buz=function(){function Buz(aiot){this.aiot=aiot}Buz.prototype.beep=function(freq,period){this.aiot.beep(freq,period);return this};return Buz}();var AIotEngineVersion="v1.1";var AIotEngine=function(){function AIotEngine(){this.aiot=new AIot;this.led=new Led(this.aiot);this.psw=new Psw(this.aiot);this.adc=new Adc(this.aiot);this.buz=new Buz(this.aiot);console.log("%cAIEngine "+AIotEngineVersion+" loaded","color:blue")}AIotEngine.prototype.start=function(callback){this.aiot.start(callback);return this};AIotEngine.prototype.start_sampler=function(interval){this.aiot.start_sampler(interval);return this};AIotEngine.prototype.stop_sampler=function(){this.aiot.stop_sampler();return this};AIotEngine.prototype.repeat=function(count,period,eachCbk,endCbk){this.aiot.repeat(count,period,eachCbk,endCbk);return this};AIotEngine.prototype.sequence=function(array,period,eachCbk,endCbk){this.aiot.sequence(array,period,eachCbk,endCbk);return this};return AIotEngine}();exports.ADC=ADC;exports.AIotEngine=AIotEngine;exports.LED=LED;exports.PSW=PSW;exports.UIButton=UIButton;exports.UIGauge=UIGauge;exports.UIKnob=UIKnob;exports.UILayout=UILayout;exports.UILed=UILed;exports.UIPanel=UIPanel;exports.UIText=UIText;exports.UIUtils=UIUtils;exports.UIWrapper=UIWrapper;